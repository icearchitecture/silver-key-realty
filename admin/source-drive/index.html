<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Source Drive — Silver Key Realty</title>
  <meta name="robots" content="noindex, nofollow">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=Outfit:wght@200;300;400;500&display=swap" rel="stylesheet">
  <style>
/* ═══════════════════════════════════════════
   SKR CRITICAL CSS — Inlined in every page
   If this renders, the page looks right.
   ═══════════════════════════════════════════ */

/* Reset */
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}

/* Base */
:root{
  --skr-bg:#111111;
  --skr-surface:#1A1A1A;
  --skr-surface-2:#1E1E1E;
  --skr-border:rgba(255,255,255,0.04);
  --skr-border-hover:rgba(255,255,255,0.08);
  --skr-text:#F0EBE3;
  --skr-text-muted:#9A8E80;
  --skr-text-dim:#7A6E60;
  --skr-champagne:#C9B99A;
  --skr-green:#3A9464;
  --skr-green-hover:#2d7a52;
  --skr-red:#e74c3c;
  --skr-sidebar-w:220px;
  --skr-font-body:'Outfit',system-ui,-apple-system,sans-serif;
  --skr-font-heading:'Cormorant Garamond',Georgia,serif;
  --skr-font-logo:Georgia,serif;
}

html{height:100%}
body{
  min-height:100vh;background:var(--skr-bg);
  font-family:var(--skr-font-body);color:var(--skr-text);
  -webkit-font-smoothing:antialiased;
}

/* Loading Screen — visible by default, hidden when page is ready */
.skr-loader{
  position:fixed;inset:0;z-index:9999;
  background:var(--skr-bg);
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  transition:opacity 0.3s ease;
}
.skr-loader.hidden{opacity:0;pointer-events:none}
.skr-loader-logo{font-family:var(--skr-font-logo);font-size:22px;color:var(--skr-text);margin-bottom:24px}
.skr-loader-logo em{color:var(--skr-champagne)}
.skr-loader-bar{width:120px;height:2px;background:rgba(255,255,255,0.06);overflow:hidden;border-radius:1px}
.skr-loader-fill{width:30%;height:100%;background:var(--skr-green);animation:skr-load 1.2s ease-in-out infinite}
@keyframes skr-load{0%{transform:translateX(-100%)}100%{transform:translateX(400%)}}
.skr-loader-text{font-size:11px;color:var(--skr-text-dim);margin-top:12px;letter-spacing:1px}

/* Shell Layout */
.skr-shell{display:flex;min-height:100vh}

/* Sidebar */
.skr-sidebar{
  width:var(--skr-sidebar-w);min-height:100vh;
  background:var(--skr-surface);
  border-right:1px solid var(--skr-border);
  display:flex;flex-direction:column;
  position:fixed;left:0;top:0;bottom:0;
  z-index:100;
  overflow-y:auto;
}
.skr-sidebar-logo{
  padding:24px 20px 20px;
  font-family:var(--skr-font-logo);font-size:16px;
  color:var(--skr-text);border-bottom:1px solid var(--skr-border);
}
.skr-sidebar-logo em{color:var(--skr-champagne)}

.skr-sidebar-nav{padding:12px 0;flex:1}
.skr-sidebar-link{
  display:flex;align-items:center;gap:10px;
  padding:10px 20px;font-size:13px;color:var(--skr-text-muted);
  text-decoration:none;transition:all 0.12s;
  border-left:2px solid transparent;
}
.skr-sidebar-link:hover{color:var(--skr-text);background:rgba(255,255,255,0.02)}
.skr-sidebar-link.active{
  color:var(--skr-champagne);
  border-left-color:var(--skr-green);
  background:rgba(58,148,100,0.04);
}
.skr-sidebar-link .icon{width:16px;text-align:center;font-size:12px;opacity:0.6}

.skr-sidebar-section{
  font-size:9px;color:var(--skr-text-dim);letter-spacing:2px;
  text-transform:uppercase;padding:16px 20px 6px;
}

.skr-sidebar-user{
  padding:16px 20px;border-top:1px solid var(--skr-border);
  font-size:12px;
}
.skr-sidebar-user-name{color:var(--skr-text);font-weight:400}
.skr-sidebar-user-role{color:var(--skr-text-dim);font-size:10px;letter-spacing:1px;text-transform:uppercase;margin-top:2px}
.skr-sidebar-signout{
  display:inline-block;margin-top:8px;font-size:10px;
  color:var(--skr-text-dim);cursor:pointer;background:none;
  border:none;font-family:var(--skr-font-body);letter-spacing:1px;
  text-transform:uppercase;
}
.skr-sidebar-signout:hover{color:var(--skr-red)}

/* Main Content */
.skr-main{
  flex:1;margin-left:var(--skr-sidebar-w);
  padding:32px;min-height:100vh;
}

/* Page Header */
.skr-page-header{margin-bottom:32px}
.skr-page-title{
  font-family:var(--skr-font-heading);font-size:32px;font-weight:300;
  color:var(--skr-text);
}
.skr-page-title em{color:var(--skr-champagne)}
.skr-page-sub{font-size:13px;color:var(--skr-text-muted);margin-top:4px}
.skr-page-meta{
  float:right;text-align:right;font-size:11px;color:var(--skr-text-dim);
}
.skr-page-meta .system-status{color:var(--skr-green);font-size:10px;letter-spacing:1px}

/* Cards */
.skr-card{
  background:var(--skr-surface);
  border:1px solid var(--skr-border);
  padding:24px;margin-bottom:16px;
}
.skr-card-title{
  font-size:10px;color:var(--skr-text-dim);
  letter-spacing:2px;text-transform:uppercase;
  margin-bottom:12px;
}
.skr-card-value{
  font-family:var(--skr-font-heading);font-size:36px;
  font-weight:300;color:var(--skr-text);
}

/* Stats Row */
.skr-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;margin-bottom:24px}

/* Two Column Layout */
.skr-grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}

/* Buttons */
.skr-btn{
  display:inline-flex;align-items:center;gap:6px;
  padding:10px 20px;font-family:var(--skr-font-body);
  font-size:11px;letter-spacing:1.5px;text-transform:uppercase;
  cursor:pointer;transition:all 0.12s;border:none;
}
.skr-btn-primary{background:var(--skr-green);color:#fff}
.skr-btn-primary:hover{background:var(--skr-green-hover)}
.skr-btn-ghost{background:none;border:1px solid var(--skr-border);color:var(--skr-text-muted)}
.skr-btn-ghost:hover{border-color:var(--skr-border-hover);color:var(--skr-text)}

/* Tables */
.skr-table{width:100%;border-collapse:collapse}
.skr-table th{
  font-size:9px;color:var(--skr-text-dim);letter-spacing:2px;
  text-transform:uppercase;padding:10px 12px;text-align:left;
  border-bottom:1px solid var(--skr-border);
}
.skr-table td{
  padding:12px;font-size:13px;color:var(--skr-text-muted);
  border-bottom:1px solid var(--skr-border);
}
.skr-table tr:hover td{background:rgba(255,255,255,0.01)}

/* Status Pills */
.skr-pill{
  display:inline-block;padding:3px 10px;font-size:10px;
  letter-spacing:1px;text-transform:uppercase;
}
.skr-pill-green{background:rgba(58,148,100,0.1);color:#3A9464;border:1px solid rgba(58,148,100,0.2)}
.skr-pill-red{background:rgba(231,76,60,0.1);color:#e74c3c;border:1px solid rgba(231,76,60,0.2)}
.skr-pill-gold{background:rgba(201,185,154,0.1);color:#C9B99A;border:1px solid rgba(201,185,154,0.2)}

/* Notification badge */
.skr-badge{
  display:inline-flex;align-items:center;justify-content:center;
  min-width:18px;height:18px;padding:0 5px;
  background:var(--skr-red);color:#fff;font-size:10px;
  font-weight:500;border-radius:9px;
}

/* Error state */
.skr-error-state{
  display:none;position:fixed;inset:0;z-index:9998;
  background:var(--skr-bg);
  flex-direction:column;align-items:center;justify-content:center;
  text-align:center;padding:24px;
}
.skr-error-state.visible{display:flex}
.skr-error-state h2{font-family:var(--skr-font-heading);font-size:24px;font-weight:300;margin-bottom:8px}
.skr-error-state p{font-size:13px;color:var(--skr-text-muted);margin-bottom:24px;max-width:400px;line-height:1.6}

/* Responsive */
@media(max-width:768px){
  .skr-sidebar{transform:translateX(-100%);transition:transform 0.2s}
  .skr-sidebar.open{transform:translateX(0)}
  .skr-main{margin-left:0;padding:16px}
  .skr-grid-2{grid-template-columns:1fr}
  .skr-stats{grid-template-columns:1fr 1fr}
}

/* Scrollbar */
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.08);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,0.12)}

/* Hide content until ready — CRITICAL */
.skr-main{opacity:0;transition:opacity 0.2s ease}
body.skr-ready .skr-main{opacity:1}

/* ═══════════════════════════════════════════
   SOURCE DRIVE PAGE STYLES
   ═══════════════════════════════════════════ */

.search-wrapper{position:relative;margin-bottom:32px}
.search-icon{position:absolute;left:16px;top:50%;transform:translateY(-50%);font-size:16px;color:rgba(255,255,255,.2);pointer-events:none}
.search-input{
  width:100%;font-family:var(--skr-font-body);font-size:16px;font-weight:300;
  color:var(--skr-text);background:rgba(255,255,255,.03);
  border:1px solid var(--skr-border);padding:16px 20px 16px 44px;
  outline:none;transition:border-color .3s;
}
.search-input::placeholder{color:rgba(255,255,255,.15);font-weight:200}
.search-input:focus{border-color:rgba(58,148,100,.3)}

.category-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.category-card{
  display:flex;align-items:center;gap:14px;padding:22px 20px;
  background:var(--skr-surface);border:1px solid var(--skr-border);
  text-decoration:none;color:inherit;transition:all .4s cubic-bezier(0.22,1,0.36,1);cursor:pointer;
}
.category-card:hover{border-color:rgba(58,148,100,.12);background:rgba(58,148,100,.03);transform:translateY(-1px)}
.category-icon{
  font-size:22px;width:36px;height:36px;display:flex;align-items:center;justify-content:center;
  background:rgba(255,255,255,.02);border:1px solid var(--skr-border);border-radius:4px;flex-shrink:0;
}
.category-info{flex:1}
.category-name{font-family:var(--skr-font-body);font-size:14px;font-weight:400;color:var(--skr-text)}
.category-desc{font-family:var(--skr-font-body);font-size:11px;font-weight:200;color:var(--skr-text-muted);margin-top:2px}

.results-container{display:none}
.results-loading{text-align:center;padding:40px;display:none}
.results-section{margin-bottom:24px}
.results-section-header{display:flex;align-items:center;gap:10px;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid var(--skr-border)}
.results-section-icon{font-size:14px;opacity:.5}
.results-section-name{font-family:var(--skr-font-body);font-size:11px;font-weight:400;letter-spacing:2px;text-transform:uppercase;color:var(--skr-champagne)}
.results-section-count{font-family:var(--skr-font-body);font-size:10px;font-weight:300;color:var(--skr-text-muted);margin-left:auto}

.result-row{
  display:flex;justify-content:space-between;align-items:center;
  padding:12px 16px;border:1px solid transparent;cursor:pointer;
  transition:all .2s;text-decoration:none;color:inherit;
}
.result-row:hover{background:rgba(58,148,100,.04);border-color:rgba(58,148,100,.08)}
.result-label{font-family:var(--skr-font-body);font-size:14px;font-weight:300;color:var(--skr-text)}
.result-meta{font-family:var(--skr-font-body);font-size:12px;font-weight:200;color:var(--skr-text-muted)}
.result-time{font-family:var(--skr-font-body);font-size:11px;font-weight:200;color:var(--skr-text-muted);white-space:nowrap;margin-left:16px}
.result-info{flex:1;min-width:0}
.result-right{display:flex;align-items:center;gap:8px;flex-shrink:0}

.no-results{text-align:center;padding:48px 24px}
.no-results-msg{font-family:var(--skr-font-body);font-size:14px;font-weight:300;color:var(--skr-text-muted)}

.spinner{width:24px;height:24px;border:2px solid rgba(58,148,100,.2);border-top-color:var(--skr-green);border-radius:50%;animation:spin .6s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

@media(max-width:900px){
  .category-grid{grid-template-columns:1fr 1fr}
}
@media(max-width:480px){
  .category-grid{grid-template-columns:1fr}
}
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div class="skr-loader" id="skr-loader">
    <div class="skr-loader-logo">Silver Key <em>Realty</em></div>
    <div class="skr-loader-bar"><div class="skr-loader-fill"></div></div>
    <div class="skr-loader-text">Loading...</div>
  </div>

  <!-- Error Fallback -->
  <div class="skr-error-state" id="skr-error-state">
    <div class="skr-loader-logo">Silver Key <em>Realty</em></div>
    <h2>Something went wrong</h2>
    <p>The page didn't load correctly. This usually fixes itself — try refreshing.</p>
    <button class="skr-btn skr-btn-primary" onclick="window.location.reload()">Refresh Page</button>
    <button class="skr-btn skr-btn-ghost" onclick="window.location.href='/admin/'" style="margin-top:8px">Back to Login</button>
  </div>

  <!-- Shell -->
  <div class="skr-shell">
    <!-- Sidebar injected by SKR_SHELL -->

    <main class="skr-main">
      <div class="skr-page-header">
        <h1 class="skr-page-title">Source <em>Drive</em></h1>
        <p class="skr-page-sub">Search across leads, deals, properties, documents, notes, and files</p>
      </div>

      <div class="search-wrapper">
        <span class="search-icon">&#128269;</span>
        <input type="text" class="search-input" id="searchInput" placeholder="Search everything..." autocomplete="off">
      </div>

      <!-- Empty state: category quick-access -->
      <div id="categoryGrid">
        <div class="category-grid">
          <a href="/admin/leads/" class="category-card">
            <div class="category-icon">&#9678;</div>
            <div class="category-info">
              <div class="category-name">Leads</div>
              <div class="category-desc">Contacts and inquiries</div>
            </div>
          </a>
          <a href="/admin/deals/" class="category-card">
            <div class="category-icon">&#11041;</div>
            <div class="category-info">
              <div class="category-name">Deals</div>
              <div class="category-desc">Pipeline and transactions</div>
            </div>
          </a>
          <a href="/admin/properties/" class="category-card">
            <div class="category-icon">&#127968;</div>
            <div class="category-info">
              <div class="category-name">Properties</div>
              <div class="category-desc">Listings and inventory</div>
            </div>
          </a>
          <a href="/admin/workspace/?view=notes" class="category-card">
            <div class="category-icon">&#128221;</div>
            <div class="category-info">
              <div class="category-name">Notes</div>
              <div class="category-desc">Workspace notes and memos</div>
            </div>
          </a>
          <a href="/admin/documents/" class="category-card">
            <div class="category-icon">&#128193;</div>
            <div class="category-info">
              <div class="category-name">Files</div>
              <div class="category-desc">Uploaded documents and files</div>
            </div>
          </a>
          <a href="/admin/email/" class="category-card">
            <div class="category-icon">&#9655;</div>
            <div class="category-info">
              <div class="category-name">Email</div>
              <div class="category-desc">Conversations and threads</div>
            </div>
          </a>
        </div>
      </div>

      <!-- Search results -->
      <div class="results-container" id="resultsContainer"></div>

      <!-- Loading -->
      <div class="results-loading" id="resultsLoading">
        <div class="spinner" style="margin:0 auto 12px"></div>
        <div style="font-family:var(--skr-font-body);font-size:12px;color:var(--skr-text-muted)">Searching...</div>
      </div>

      <!-- No results -->
      <div class="no-results" id="noResults" style="display:none">
        <div class="no-results-msg" id="noResultsMsg">No results found.</div>
      </div>
    </main>
  </div>

  <!-- Scripts -->
  <script src="../../assets/js/admin-config.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script src="../assets/includes/skr-shell.js"></script>
  <script src="../assets/js/skr-auth.js"></script>
  <script>
  var shell = SKR_SHELL.init({ activePage: 'source-drive' });

  SKR_AUTH.guard(function(member, sb) {
    shell.render(member);
    loadPageData(member, sb);
  });

  function loadPageData(member, sb) {
    var categoryGrid = document.getElementById('categoryGrid');
    var resultsContainer = document.getElementById('resultsContainer');
    var resultsLoading = document.getElementById('resultsLoading');
    var noResults = document.getElementById('noResults');

    var categoryConfig = {
      leads:      { icon: '&#9678;',  name: 'Leads',      url: '/admin/leads/' },
      deals:      { icon: '&#11041;', name: 'Deals',      url: '/admin/deals/' },
      properties: { icon: '&#127968;', name: 'Properties', url: '/admin/properties/' },
      notes:      { icon: '&#128221;', name: 'Notes',      url: '/admin/workspace/?view=notes' },
      files:      { icon: '&#128193;', name: 'Files',      url: '/admin/documents/' },
      email:      { icon: '&#9655;',  name: 'Email',      url: '/admin/email/' }
    };

    function escapeHtml(str) {
      if (!str) return '';
      var div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    function timeAgo(dateStr) {
      if (!dateStr) return '';
      var diff = Date.now() - new Date(dateStr).getTime();
      var min = Math.floor(diff / 60000);
      if (min < 1) return 'Just now';
      if (min < 60) return min + 'm ago';
      var hrs = Math.floor(min / 60);
      if (hrs < 24) return hrs + 'h ago';
      var days = Math.floor(hrs / 24);
      if (days < 30) return days + 'd ago';
      return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }

    function renderResults(data) {
      var categories = data.results || data;
      var html = '';
      var hasResults = false;

      Object.keys(categories).forEach(function(key) {
        var items = categories[key];
        if (!items || !items.length) return;
        hasResults = true;

        var cfg = categoryConfig[key] || { icon: '&#9679;', name: key, url: '#' };

        html += '<div class="results-section">';
        html += '<div class="results-section-header">';
        html += '<span class="results-section-icon">' + cfg.icon + '</span>';
        html += '<span class="results-section-name">' + cfg.name + '</span>';
        html += '<span class="results-section-count">' + items.length + ' result' + (items.length !== 1 ? 's' : '') + '</span>';
        html += '</div>';

        items.forEach(function(item) {
          var label = item.label || item.name || item.title || item.deal_name || 'Untitled';
          var meta = item.metadata || item.meta || item.description || '';
          var time = item.updated_at || item.created_at || '';
          var url = item._url || item.url || cfg.url;

          html += '<a class="result-row" href="' + escapeHtml(url) + '">';
          html += '<div class="result-info">';
          html += '<div class="result-label">' + escapeHtml(label) + '</div>';
          if (meta) html += '<div class="result-meta">' + escapeHtml(meta) + '</div>';
          html += '</div>';
          html += '<div class="result-right">';
          if (time) html += '<span class="result-time">' + timeAgo(time) + '</span>';
          html += '</div>';
          html += '</a>';
        });

        html += '</div>';
      });

      return { html: html, hasResults: hasResults };
    }

    async function performSearch(query) {
      categoryGrid.style.display = 'none';
      resultsContainer.style.display = 'none';
      noResults.style.display = 'none';
      resultsLoading.style.display = 'block';

      try {
        var session = await sb.auth.getSession();
        var token = session.data.session ? session.data.session.access_token : null;

        var resp = await fetch('/api/search?q=' + encodeURIComponent(query), {
          headers: { 'Authorization': 'Bearer ' + token, 'Content-Type': 'application/json' }
        });

        if (!resp.ok) throw new Error('API returned ' + resp.status);

        var data = await resp.json();
        resultsLoading.style.display = 'none';

        var result = renderResults(data);
        if (result.hasResults) {
          resultsContainer.innerHTML = result.html;
          resultsContainer.style.display = 'block';
        } else {
          document.getElementById('noResultsMsg').textContent = "No results found for '" + query + "'.";
          noResults.style.display = 'block';
        }
      } catch (err) {
        console.warn('[SKR] Search API error, falling back to Supabase:', err);

        try {
          var results = {};
          var searchPattern = '%' + query + '%';

          var [leadsR, dealsR, propsR, notesR, filesR] = await Promise.all([
            sb.from('skr_leads').select('id, first_name, last_name, email, pathway, created_at')
              .or('first_name.ilike.' + searchPattern + ',last_name.ilike.' + searchPattern + ',email.ilike.' + searchPattern)
              .order('created_at', { ascending: false }).limit(10),
            sb.from('skr_deals').select('id, deal_name, deal_type, status, updated_at')
              .ilike('deal_name', searchPattern)
              .order('updated_at', { ascending: false }).limit(10),
            sb.from('skr_properties').select('id, address_line1, city, state, status, updated_at')
              .or('address_line1.ilike.' + searchPattern + ',city.ilike.' + searchPattern)
              .order('updated_at', { ascending: false }).limit(10),
            sb.from('skr_workspace_notes').select('id, title, content, updated_at')
              .or('title.ilike.' + searchPattern + ',content.ilike.' + searchPattern)
              .order('updated_at', { ascending: false }).limit(10),
            sb.from('skr_workspace_files').select('id, file_name, description, created_at')
              .or('file_name.ilike.' + searchPattern + ',description.ilike.' + searchPattern)
              .order('created_at', { ascending: false }).limit(10)
          ]);

          if (leadsR.data && leadsR.data.length) {
            results.leads = leadsR.data.map(function(l) {
              return { label: [l.first_name, l.last_name].filter(Boolean).join(' ') || l.email, metadata: l.pathway || '', _url: '/admin/leads/detail.html?id=' + l.id, updated_at: l.created_at };
            });
          }
          if (dealsR.data && dealsR.data.length) {
            results.deals = dealsR.data.map(function(d) {
              return { label: d.deal_name, metadata: (d.deal_type || '') + ' · ' + (d.status || ''), _url: '/admin/deals/detail.html?id=' + d.id, updated_at: d.updated_at };
            });
          }
          if (propsR.data && propsR.data.length) {
            results.properties = propsR.data.map(function(p) {
              return { label: p.address_line1 || 'Property', metadata: [p.city, p.state].filter(Boolean).join(', '), _url: '/admin/properties/detail.html?id=' + p.id, updated_at: p.updated_at };
            });
          }
          if (notesR.data && notesR.data.length) {
            results.notes = notesR.data.map(function(n) {
              return { label: n.title || 'Untitled Note', metadata: (n.content || '').substring(0, 80), _url: '/admin/workspace/', updated_at: n.updated_at };
            });
          }
          if (filesR.data && filesR.data.length) {
            results.files = filesR.data.map(function(f) {
              return { label: f.file_name, metadata: f.description || '', _url: '/admin/workspace/', updated_at: f.created_at };
            });
          }

          resultsLoading.style.display = 'none';
          var result = renderResults(results);
          if (result.hasResults) {
            resultsContainer.innerHTML = result.html;
            resultsContainer.style.display = 'block';
          } else {
            document.getElementById('noResultsMsg').textContent = "No results found for '" + query + "'.";
            noResults.style.display = 'block';
          }
        } catch (sbErr) {
          console.warn('[SKR] Supabase search fallback failed:', sbErr);
          resultsLoading.style.display = 'none';
          document.getElementById('noResultsMsg').textContent = "Search unavailable. Please try again.";
          noResults.style.display = 'block';
        }
      }
    }

    function resetToEmpty() {
      categoryGrid.style.display = 'block';
      resultsContainer.style.display = 'none';
      resultsLoading.style.display = 'none';
      noResults.style.display = 'none';
    }

    var searchTimeout;
    document.getElementById('searchInput').addEventListener('input', function() {
      clearTimeout(searchTimeout);
      var val = this.value.trim();

      if (!val) {
        resetToEmpty();
        return;
      }

      searchTimeout = setTimeout(function() {
        performSearch(val);
      }, 300);
    });

    document.getElementById('searchInput').addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        this.value = '';
        resetToEmpty();
        this.blur();
      }
    });
  }
  </script>
</body>
</html>
