<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Silver Key Realty — Join Our Team</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=Outfit:wght@200;300;400;500&display=swap" rel="stylesheet">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { min-height:100vh; background:#111111; font-family:'Outfit',sans-serif; color:#F0EBE3; }

    .pw-header {
      padding:20px 32px; border-bottom:1px solid rgba(255,255,255,0.04);
      display:flex; justify-content:space-between; align-items:center;
    }
    .pw-logo { font-family:Georgia,serif; font-size:18px; color:#F0EBE3; text-decoration:none; }
    .pw-logo em { color:#C9B99A; }
    .pw-back { font-size:12px; color:#9A8E80; text-decoration:none; }
    .pw-back:hover { color:#F0EBE3; }

    .pw-hero {
      text-align:center; padding:60px 24px 40px;
      background:linear-gradient(180deg, rgba(58,148,100,0.03) 0%, transparent 100%);
    }
    .pw-badge {
      display:inline-block; padding:4px 14px; border:1px solid rgba(58,148,100,0.2);
      font-size:10px; color:#3A9464; letter-spacing:2px; text-transform:uppercase;
      margin-bottom:16px;
    }
    .pw-title {
      font-family:'Cormorant Garamond',serif; font-size:36px; font-weight:300;
      color:#F0EBE3; margin-bottom:8px;
    }
    .pw-title em { color:#C9B99A; }
    .pw-sub { font-size:14px; color:#9A8E80; max-width:500px; margin:0 auto; line-height:1.7; }

    .pw-form-container { max-width:560px; margin:0 auto; padding:0 24px 60px; }

    .pw-step { display:none; }
    .pw-step.active { display:block; }

    .pw-step-label {
      font-size:10px; color:#7A6E60; letter-spacing:2px; text-transform:uppercase;
      margin-bottom:20px; padding-bottom:12px; border-bottom:1px solid rgba(255,255,255,0.04);
    }

    .pw-field { margin-bottom:16px; }
    .pw-field label {
      display:block; font-size:11px; color:#9A8E80; letter-spacing:1px;
      text-transform:uppercase; margin-bottom:6px;
    }
    .pw-field input, .pw-field select, .pw-field textarea {
      width:100%; padding:12px 16px; background:rgba(255,255,255,0.03);
      border:1px solid rgba(255,255,255,0.08); color:#F0EBE3;
      font-family:'Outfit',sans-serif; font-size:14px; outline:none; transition:all 0.15s;
    }
    .pw-field input:focus, .pw-field select:focus, .pw-field textarea:focus {
      border-color:rgba(58,148,100,0.4); box-shadow:0 0 0 3px rgba(58,148,100,0.05);
    }
    .pw-field input::placeholder, .pw-field textarea::placeholder { color:rgba(255,255,255,0.2); }
    .pw-field select { appearance:none; cursor:pointer; }
    .pw-field select option { background:#1A1A1A; color:#F0EBE3; }
    .pw-field textarea { min-height:100px; resize:vertical; }

    .pw-row { display:grid; grid-template-columns:1fr 1fr; gap:12px; }

    .pw-upload-zone {
      border:2px dashed rgba(255,255,255,0.06); padding:32px; text-align:center;
      cursor:pointer; transition:all 0.15s; margin-bottom:16px;
    }
    .pw-upload-zone:hover { border-color:rgba(58,148,100,0.3); background:rgba(58,148,100,0.02); }
    .pw-upload-zone p { font-size:13px; color:#9A8E80; margin-bottom:4px; }
    .pw-upload-zone .hint { font-size:11px; color:#7A6E60; }
    .pw-file-list { list-style:none; }
    .pw-file-item {
      display:flex; justify-content:space-between; align-items:center;
      padding:8px 12px; background:rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.04); margin-bottom:4px;
      font-size:12px; color:#9A8E80;
    }
    .pw-file-remove { background:none; border:none; color:#e74c3c; cursor:pointer; font-size:14px; padding:0 4px; }

    .pw-nav { display:flex; justify-content:space-between; margin-top:32px; }
    .pw-btn-back {
      padding:12px 24px; background:none; border:1px solid rgba(255,255,255,0.08);
      color:#9A8E80; font-family:'Outfit',sans-serif; font-size:11px;
      letter-spacing:1.5px; text-transform:uppercase; cursor:pointer; transition:all 0.15s;
    }
    .pw-btn-back:hover { border-color:rgba(255,255,255,0.2); color:#F0EBE3; }
    .pw-btn-next {
      padding:12px 32px; background:#3A9464; border:none; color:#F0EBE3;
      font-family:'Outfit',sans-serif; font-size:11px; letter-spacing:2px;
      text-transform:uppercase; cursor:pointer; transition:all 0.15s;
    }
    .pw-btn-next:hover { background:#2d7a52; }
    .pw-btn-next:disabled { opacity:0.5; cursor:not-allowed; }

    .pw-progress { display:flex; gap:8px; justify-content:center; margin-bottom:32px; }
    .pw-dot { width:8px; height:8px; border-radius:50%; background:rgba(255,255,255,0.1); transition:all 0.2s; }
    .pw-dot.active { background:#3A9464; }
    .pw-dot.done { background:#C9B99A; }

    .pw-success { text-align:center; padding:60px 24px; }
    .pw-success-icon {
      width:60px; height:60px; border-radius:50%;
      background:rgba(58,148,100,0.1); border:2px solid rgba(58,148,100,0.3);
      display:flex; align-items:center; justify-content:center;
      margin:0 auto 20px; font-size:24px;
    }
    .pw-success h2 { font-family:'Cormorant Garamond',serif; font-size:24px; font-weight:300; margin-bottom:8px; }
    .pw-success p { font-size:14px; color:#9A8E80; line-height:1.7; }

    @media (max-width:600px) { .pw-row { grid-template-columns:1fr; } .pw-title { font-size:28px; } }
  </style>
</head>
<body>
  <header class="pw-header">
    <a href="/" class="pw-logo">Silver Key <em>Realty</em></a>
    <a href="/" class="pw-back">← Back to home</a>
  </header>

  <div class="pw-hero">
    <div class="pw-badge">Agent</div>
    <h1 class="pw-title">Join the <em>Team</em></h1>
    <p class="pw-sub">Interested in joining Silver Key Realty? Tell us about your experience.</p>
  </div>

  <div class="pw-form-container">
    <div class="pw-progress">
      <div class="pw-dot active" id="dot-0"></div>
      <div class="pw-dot" id="dot-1"></div>
      <div class="pw-dot" id="dot-2"></div>
    </div>

    <!-- Step 1: Contact Info -->
    <div class="pw-step active" id="step-0">
      <div class="pw-step-label">Step 1 — Contact Information</div>
      <div class="pw-row">
        <div class="pw-field"><label>First Name</label><input id="pw-first" placeholder="Marcus"></div>
        <div class="pw-field"><label>Last Name</label><input id="pw-last" placeholder="Johnson"></div>
      </div>
      <div class="pw-field"><label>Email</label><input id="pw-email" type="email" placeholder="marcus@email.com"></div>
      <div class="pw-field"><label>Phone</label><input id="pw-phone" type="tel" placeholder="(248) 555-0100"></div>
      <div class="pw-field"><label>How did you hear about us?</label>
        <select id="pw-source">
          <option value="">— Select —</option>
          <option value="referral">Referral</option>
          <option value="google">Google Search</option>
          <option value="social">Social Media</option>
          <option value="linkedin">LinkedIn</option>
          <option value="other">Other</option>
        </select>
      </div>
      <div class="pw-nav">
        <div></div>
        <button class="pw-btn-next" onclick="nextStep()">Continue</button>
      </div>
    </div>

    <!-- Step 2: Agent-Specific Questions -->
    <div class="pw-step" id="step-1">
      <div class="pw-step-label">Step 2 — Your Experience</div>
      <div class="pw-field"><label>Current License Status</label>
        <select id="pw-license-status">
          <option value="">— Select —</option>
          <option value="active">Active</option>
          <option value="inactive">Inactive</option>
          <option value="in-progress">In Progress</option>
          <option value="not-licensed">Not Licensed</option>
        </select>
      </div>
      <div class="pw-row">
        <div class="pw-field"><label>License State</label>
          <select id="pw-license-state">
            <option value="">— Select —</option>
            <option value="MI">Michigan</option>
            <option value="OH">Ohio</option>
            <option value="IN">Indiana</option>
            <option value="IL">Illinois</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="pw-field"><label>Years of Experience</label>
          <select id="pw-experience">
            <option value="">— Select —</option>
            <option value="0">0 (New to real estate)</option>
            <option value="1-3">1 – 3 years</option>
            <option value="3-5">3 – 5 years</option>
            <option value="5-10">5 – 10 years</option>
            <option value="10+">10+ years</option>
          </select>
        </div>
      </div>
      <div class="pw-field"><label>Current Brokerage</label><input id="pw-brokerage" placeholder="Brokerage name or 'None'"></div>
      <div class="pw-field"><label>Specialties</label>
        <select id="pw-specialty">
          <option value="">— Select —</option>
          <option value="buyer-agent">Buyer's Agent</option>
          <option value="listing-agent">Listing Agent</option>
          <option value="commercial">Commercial</option>
          <option value="property-management">Property Management</option>
          <option value="new-construction">New Construction</option>
        </select>
      </div>
      <div class="pw-field"><label>LinkedIn or Website URL</label><input id="pw-linkedin" placeholder="https://linkedin.com/in/yourprofile"></div>
      <div class="pw-field"><label>Why Silver Key?</label>
        <textarea id="pw-notes" placeholder="Tell us why you're interested in joining Silver Key Realty..."></textarea>
      </div>
      <div class="pw-nav">
        <button class="pw-btn-back" onclick="prevStep()">Back</button>
        <button class="pw-btn-next" onclick="nextStep()">Continue</button>
      </div>
    </div>

    <!-- Step 3: Document Upload -->
    <div class="pw-step" id="step-2">
      <div class="pw-step-label">Step 3 — Supporting Documents (Optional)</div>
      <p style="font-size:13px;color:#9A8E80;margin-bottom:20px;line-height:1.6;">If you have any documents ready, upload them here. This helps us learn more about you.</p>
      
      <div class="pw-upload-zone" id="upload-zone" onclick="document.getElementById('file-input').click()">
        <p>Click to upload or drag files here</p>
        <div class="hint">Resume, license copy, references — PDF, DOC, JPG up to 10MB each</div>
      </div>
      <input type="file" id="file-input" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" style="display:none" onchange="handleFiles(this.files)">
      <ul class="pw-file-list" id="file-list"></ul>

      <div class="pw-field" style="margin-top:16px;">
        <label>Or paste a link to documents</label>
        <input id="pw-link" placeholder="Google Drive, Dropbox, or website URL">
      </div>

      <div class="pw-nav">
        <button class="pw-btn-back" onclick="prevStep()">Back</button>
        <button class="pw-btn-next" id="submit-btn" onclick="submitInquiry()">Submit Application</button>
      </div>
    </div>

    <!-- Success -->
    <div class="pw-step" id="step-3">
      <div class="pw-success">
        <div class="pw-success-icon">✓</div>
        <h2>Thank You</h2>
        <p>Your application has been received. Our team will review your information and reach out to discuss next steps.</p>
        <p style="margin-top:16px;font-size:12px;color:#7A6E60;">Check your email for a confirmation from Silver Key Realty.</p>
        <a href="/" class="pw-btn-back" style="display:inline-block;margin-top:24px;text-decoration:none;">Back to Home</a>
      </div>
    </div>
  </div>

  <script>
    let currentStep = 0;
    let uploadedFiles = [];

    function nextStep() {
      if (currentStep === 0) {
        const first = document.getElementById('pw-first').value.trim();
        const email = document.getElementById('pw-email').value.trim();
        if (!first || !email) { alert('Please enter at least your first name and email.'); return; }
      }
      document.getElementById('step-' + currentStep).classList.remove('active');
      document.getElementById('dot-' + currentStep).classList.remove('active');
      document.getElementById('dot-' + currentStep).classList.add('done');
      currentStep++;
      document.getElementById('step-' + currentStep).classList.add('active');
      if (document.getElementById('dot-' + currentStep)) document.getElementById('dot-' + currentStep).classList.add('active');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function prevStep() {
      document.getElementById('step-' + currentStep).classList.remove('active');
      if (document.getElementById('dot-' + currentStep)) document.getElementById('dot-' + currentStep).classList.remove('active');
      currentStep--;
      document.getElementById('step-' + currentStep).classList.add('active');
      document.getElementById('dot-' + currentStep).classList.remove('done');
      document.getElementById('dot-' + currentStep).classList.add('active');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function handleFiles(files) {
      for (const f of files) {
        if (f.size > 10 * 1024 * 1024) { alert(f.name + ' is too large. Max 10MB per file.'); continue; }
        uploadedFiles.push(f);
      }
      renderFileList();
    }

    function removeFile(idx) { uploadedFiles.splice(idx, 1); renderFileList(); }

    function renderFileList() {
      const list = document.getElementById('file-list');
      list.innerHTML = uploadedFiles.map((f, i) =>
        `<li class="pw-file-item"><span>${f.name} (${(f.size/1024).toFixed(0)}KB)</span><button class="pw-file-remove" onclick="removeFile(${i})">✕</button></li>`
      ).join('');
    }

    const zone = document.getElementById('upload-zone');
    zone.addEventListener('dragover', (e) => { e.preventDefault(); zone.style.borderColor = 'rgba(58,148,100,0.4)'; });
    zone.addEventListener('dragleave', () => { zone.style.borderColor = 'rgba(255,255,255,0.06)'; });
    zone.addEventListener('drop', (e) => { e.preventDefault(); zone.style.borderColor = 'rgba(255,255,255,0.06)'; handleFiles(e.dataTransfer.files); });

    async function submitInquiry() {
      const btn = document.getElementById('submit-btn');
      btn.textContent = 'SUBMITTING...'; btn.disabled = true;

      const payload = {
        pathway: 'agent',
        first_name: document.getElementById('pw-first').value.trim(),
        last_name: document.getElementById('pw-last').value.trim(),
        email: document.getElementById('pw-email').value.trim(),
        phone: document.getElementById('pw-phone').value.trim(),
        source: document.getElementById('pw-source').value,
        details: {
          license_status: document.getElementById('pw-license-status').value,
          license_state: document.getElementById('pw-license-state').value,
          years_experience: document.getElementById('pw-experience').value,
          current_brokerage: document.getElementById('pw-brokerage').value.trim(),
          specialty: document.getElementById('pw-specialty').value,
          linkedin_url: document.getElementById('pw-linkedin').value.trim(),
          notes: document.getElementById('pw-notes').value.trim(),
          document_link: document.getElementById('pw-link').value.trim(),
          file_count: uploadedFiles.length,
          file_names: uploadedFiles.map(f => f.name)
        }
      };

      try {
        const res = await fetch('/api/leads/submit', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
        if (!res.ok) throw new Error('Submission failed');

        if (uploadedFiles.length > 0) {
          const data = await res.json();
          const leadId = data.id || data.lead_id;
          if (leadId) {
            for (const file of uploadedFiles) {
              const formData = new FormData();
              formData.append('file', file);
              formData.append('lead_id', leadId);
              formData.append('pathway', 'agent');
              await fetch('/api/leads/upload', { method: 'POST', body: formData }).catch(() => {});
            }
          }
        }
        nextStep();
      } catch (err) {
        alert('Something went wrong. Please try again or call us directly.');
        btn.textContent = 'Submit Application'; btn.disabled = false;
      }
    }
  </script>
</body>
</html>
